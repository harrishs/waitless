<% include partials/_header %>
<!-- Map div -- the browse-map-section -->


<form method="POST" action="/restaurants" class="search-form">

<!-- SEARCH -->
  <!-- <label for="search_value">Search:</label> -->
  <input type="text" name="search_value" class="search-input" placeholder="Search">
  <button type="submit">Submit</button>

<!-- FILTER -->
  <label for="search">Search by:</label>

  <select name="search" id="search">
    <option value="">--</option>
    <option value="type">Type</option>
    <option value="name">Name</option>
    <option value="waitlist">Waitlist Time</option>
  </select>

</form>

<div class= "map" id='browse-map-section'></div>

<% for (let restaurant of restaurants) { %>
  <div class= "container">
  <div class="restaurant-image container-stack">
      <img src= "<%= restaurant.image_url %>">
  </div>
  <div class="<%= restaurant.id %> container-stack">
    <h3 class="restaurant-name"><%= restaurant.name %></h3>
    <p><%= restaurant.type %> <%= restaurant.wait_time ? ` | ${restaurant.wait_time} Min Wait` : ` | < 5 Min Wait` %>
    </p>
    <% if (restaurant.waitlist_id !== null) { %>
      <% if (bookedWith != restaurant.waitlist_id) { %>
        <% include partials/waitlist_entries/_add %>
      <% } else { %>
        <% include partials/waitlist_entries/_remove %>
        <a href="/entries" style=>View Status of Booking</a>
      <% } %>
    <% } %>
  </div>
</div>
  <div class="addressValue" style="display: none;"><%= restaurant.address %></div>
<% } %>
<% include partials/_google_maps %>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAcVOAEYSVHbc_M8e70aGmMm9A0Z8MO1qY&callback=initMap" async defer></script>
<script src="/socket.io/socket.io.js"></script>
<script>
  var socket = io();
  document.getElementById("submit").addEventListener("click", () => {
      socket.emit("reload", {page: "/browse"});
  })
  document.getElementById("remove").addEventListener("click", () => {
      socket.emit("reload", {page: "/browse"});
  })
  socket.on("reload", (data)=>{
    if (data.page === "/browse"){
      window.location.reload();
    }
  })
</script>
<% include partials/_footer %>


